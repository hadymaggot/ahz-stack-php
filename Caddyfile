# AHZ-Stack-PHP: PHP Development Environment with FrankenPHP, MySQL, Redis, and Admin Tools
# Version: 1.0.0
# Developer: ahadizapto (9hs@tuta.io)
# License: MIT

{
    auto_https off
    frankenphp
    order php_server before file_server
}

http://localhost, https://localhost {
    root * /app/public

    # Security headers
    header {
        X-Content-Type-Options "nosniff"
        X-Frame-Options "SAMEORIGIN"
        X-XSS-Protection "1; mode=block"
        Referrer-Policy "no-referrer-when-downgrade"
        -Server
    }

    # Rewrite rules for frameworks
    @laravel expression {env.PHP_FRAMEWORK} == "laravel"
    handle @laravel {
        root * /app/frameworks/laravel/public
        php_server
    }

    @symfony expression {env.PHP_FRAMEWORK} == "symfony"
    handle @symfony {
        root * /app/frameworks/symfony/public
        php_server
    }

    @codeigniter expression {env.PHP_FRAMEWORK} == "codeigniter"
    handle @codeigniter {
        root * /app/frameworks/codeigniter/public
        php_server
    }

    # Default handler for no framework
    @default expression {env.PHP_FRAMEWORK} == "none" || {env.PHP_FRAMEWORK} == ""
    handle @default {
        # Pass all requests to FrankenPHP
        php_server
    }

    # Fallback handler
    handle {
        php_server
    }
}

http://pma.localhost, https://pma.localhost {
    basic_auth {
        admin $2y$10$BQHBvdY0bM0jW5NZgzFCOuox1ZPE9z9Fn1zU7IT9J.GhK1ZZz7ITq
    }
    reverse_proxy phpmyadmin:80
}

http://redis.localhost, https://redis.localhost {
    basic_auth {
        admin $2y$10$BQHBvdY0bM0jW5NZgzFCOuox1ZPE9z9Fn1zU7IT9J.GhK1ZZz7ITq
    }
    reverse_proxy redis-commander:8081
}